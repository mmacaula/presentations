<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Navigating the Promised Land, Promises in Javascript</title>

		<meta name="description" content="A talk on promises in javascript">
		<meta name="author" content="Mike Macaulay">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/moon.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
        <script src="node_modules/jquery/dist/jquery.min.js"></script>
        <script src="node_modules/q/q.js"></script>
        <script src="node_modules/lodash/index.js"></script>

        <style>
            button {
                height : 50px;
                width : 200px;
            }
            .block {
                position: absolute;
                background-color: #abc;
                left: 50px;
                width: 90px;
                height: 90px;
                margin: 5px;
                top : 0px;
                bottom : 0px;
            }
        </style>
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Navigating the Promised Land</h1>
					<p>Promises in Javascript</p>
					<p>
						<small>Created by <a href="http://github.com/mmacaula">Mike Macaulay</a> / <a href="http://twitter.com/mmacaula">@mmacaula</a></small>
					</p>
				</section>

				<section>
                    <section>

                        <h2>Who Am I?</h2>
                        <ul>
                            <li>Java for about 8 years</li>
                            <li>Moved to Omaha 2.5 years ago</li>
                            <li>Web / Javascript developer ever since</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Who I work for</h2>
                        <img src="lib/aviture-logo.png">
                    </section>
				</section>
                <section>
                    <h2>Agenda</h2>
                    <ul>
                        <li>Why do I care?</li>
                        <li>Introduction to promises</li>
                        <li>Why they're useful</li>
                        <li>How you can use them</li>
                        <li>Potential pitfalls</li>
                    </ul>
                </section>

                <!--<section> TODO-->
                    <!--<h2>Promises are a tool</h2>-->
                    <!--<p>A very powerful tool</p>-->
                    <!--<p>to make sense of asynchronous code</p>-->
                <!--</section>-->
                <section>
                    <h2>Best demonstrated with an example</h2>
                    <p>using jQuery animate()</p>
                    <p>Contrived, but will demonstrate concepts</p>

                </section>
                <section>
                    <h2>Animation</h2>
                    <ol>
                        <li>Go down</li>
                        <li>Go up and right</li>
                        <li>Go translucent and wide</li>
                        <li>Go back</li>
                    </ol>
                    <button id="example-done">Run Example</button>
                    <div class="block"></div>
                </section>
                <section>
                    <section>
                        <h2>Without promises</h2>
                    </section>

                    <section>
                        <h2>Let's go down then up</h2>
                        <pre><code data-trim>
// API Reference
// element.animate(options, duration, callback);
$(element).animate({
    top : '+=50px'
}, 1000, function() {
    $(element).animate({
        top: '-=50px'
    }, 1000);
});
                            </code></pre>
                        <div class="block"></div>
                        <button id="example1">Run</button>
                    </section>
                    <section>
                        <h2>If we keep going...</h2>
                        <pre><code data-trim>
   $(element).animate({
        top : '+=50px'
    }, 1000, function() {
        $(element).animate({
            top: '-=50px',
            left : '+=50px'
        }, 1000, function(){
            $(element).animate({
                width : '+=50px',
                opacity : 0.5
            }, 1000, function(){
                $(element).animate({
                    opacity : 1.0,
                    left : '-50px',
                    width : '-=50px'
                })
            })
        });
    });
                            </code></pre>
                        <div class="block"></div>
                        <button id="example2">Run</button>
                        <h2 class="fragment">This is called "Pyramid of Doom"</h2>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Let's refactor</h2>
                        <h4>(Still without promises)</h4>
                        <p class="fragment">I think we'll find we're still forced into some unwise decisions</p>

                    </section>
                    <section>
                        <h4>Let's declare our functions beforehand</h4>
                    <pre><code data-trim>
var leftFull = function() {
    $(element).animate({
        opacity: 1.0,
        left: '-50px',
        width: '-=50px'
    }, 1000)
};
var wideSeeThrough = function() {
    $(element).animate({
        width: '+=50px',
        opacity: 0.5
    }, 1000, leftFull)
};
var upRight = function() {
    $(element).animate({
        top: '-=50px',
        left: '+=50px'
    }, 1000, wideSeeThrough);
};
$(element).animate({
    top : '+=50px'
}, 1000, upRight);
                    </code></pre>
                        <h4>Hardly better.  We've flattened the pyramid but made harder to read</h4>
                    </section>
                    <section>
                        <h4>Let's keep trying (using callbacks)</h4>
                        <pre><code data-trim>
var leftFull = function() {
    $(element).animate({
        opacity: 1.0,
        left: '-50px',
        width: '-=50px'
    }, 1000)
};
var wideSeeThrough = function(cb) {
    $(element).animate({
        width: '+=50px',
        opacity: 0.5
    }, 1000, cb)
};
var upRight = function(cb) {
    $(element).animate({
        top: '-=50px',
        left: '+=50px'
    }, 1000, cb);
};
$(element).animate({
    top : '+=50px'
}, 1000, upRight(wideSeeThrough(leftFull)));
                            </code></pre>
                        <div class="block"></div>
                        <button id="example3">Run</button>
                        <h4 class="fragment">oops... </h4>
                        <h4 class="fragment">this is called "callback hell"</h4>
                    </section>
                    <section>
                        <h4>Functional programming to the rescue (using lodash partials)</h4>
                        
                        <pre><code>
var leftFull = // function def
var wideSeeThrough = // function def
var upRight =// function def

$(element).animate({
    top : '+=50px'
}, 1000, _.partial(upRight, _.partial(wideSeeThrough,leftFull)));
                        </code></pre>
                        <div class="block"></div>
                        <button id="example4">Run</button>
                        <h4 class="fragment">This works, but</h4>
                    </section>
                    
                </section>
                <section>
                   <h2>Ughh</h2>
                    <p>that's some ugly code..</p>
                    <ul>
                        <li class="fragment">We've got code declared before it's used</li>
                        <li class="fragment">Had to resort to advanced functional programming to even get it to work</li>
                        <li class="fragment">What if we had to worry about errors (say we're making AJAX requests?)</li>
                    </ul>
                </section>
                <section>
                    <h1>THEN()</h1><h2> there were Promises!</h2>
                    <h3>har har har</h3>
                </section>
                <section>
                    <h2>Promises</h2>
                    <blockquote cite="https://github.com/kriskowal/q"> A promise is an object that represents the return value or the thrown exception that the function may eventually provide.</blockquote>
                    <small>Q.js docs</small>
                </section>
                <section>
                    <h2>The middle</h2>
                    <p>the heart of all promises is the `then` function</p>
                    <ul class="fragment">
                        <li>This receives two arguments</li>
                        <li>A function to be called on success (resolve)</li>
                        <li>A function to be called on error (reject)</li>
                    </ul>
                </section>
                <section>
                    <section>
                        <h2>Example</h2>
                        <p>Let's go back to our example</p>
                        <pre><code>
var leftFull = // function def
var wideSeeThrough = // function def
var upRight =// function def
var goDown = // function def

return goDown(element)
.then(function(){
    return upRight(element);
})
.then(function(){
    return wideSeeThrough(element);
})
.then(function(){
    return leftFull(element)
});
                        </code></pre>
                    </section>
                </section>
                <section>
                    <h2>So how do we get there?</h2>
                </section>
                <section>
                    <section>
                        <h2>Step 1: Research libraries</h2>
                        <ul class="fragment">
                            <li>Deferred.js</li>
                            <li>Q.js</li>
                            <li>task.js</li>
                            <li>when.js</li>
                            <li>RSVP.js</li>
                            <li>jQuery deferred</li>
                            <li>much much more!</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Hmmm</h2>
                        <img src="lib/standards.png">
                    </section>
                    <section>
                        <h2>Just kidding</h2>
                        <h3>There are really just three (kind of)</h3>
                        <ul>
                            <li class="fragment">Promises A+</li>
                            <li class="fragment">Native browser support!</li>
                            <li class="fragment">jQuery's deferreds  - <span class="fragment">Avoid them!</span></li>
                        </ul>
                    </section>
                    <section>
                        <h2>Making a promise</h2>
                        <h4>Let's convert our animate call into a promise</h4>
                        <p> I'll be using native javascript promises for now</p>
                        <pre><code>
// old code:
function goDown(element, callback){
    element.animate({
        top : '+=50px'
    }, 1000, callback);
}
// new code
function goDown(element){
    return new Promise(function(resolve){
        element.animate({
            top : '+=50px'
            }, 1000, resolve);
    });
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Now let's chain it together</h2>
                        <pre><code>
function goDown(element){
// rest of go down
}
function upRight(element){
    return new Promise(function(resolve){
        element.animate({
            top: '-=50px',
            left : '+=50px'
        }, 1000, resolve);
    });
goDown(element)
.then(function(){
    return upRight(element);
});
                        </code></pre>
                    </section>
                    <section>
                        <h2>and so on and so forth</h2>
                        <p>get's us to this: </p>
                                                <pre><code>
var leftFull = // function def
var wideSeeThrough = // function def
var upRight =// function def
var goDown = // function def

return goDown(element)
.then(function(){
    return upRight(element);
})
.then(function(){
    return wideSeeThrough(element);
})
.then(function(){
    return leftFull(element)
});
                        </code></pre>

                    </section>
                    <section>
                        <h2>Still a little unwieldy</h2>
                        <ul class="fragment">
                            <li>We're using closures here (element)</li>
                            <li>All those anonymous functions bother me</li>
                        </ul>
                    </section>

                </section>
                <section>
                    <h2>Promises can also return values </h2>
                    <p>Simply call the 'resolve' function with a value</p>
                    <pre class="fragment"><code>
 // new code
function goDown(element){
    return new Promise(function(resolve){
        element.animate({
            top : '+=50px'
            }, 1000, resolve);
    });
}
// newer code
function goDown(element){
    return new Promise(function(resolve){
        element.animate({
            top : '+=50px'
            }, 1000, function(){
               resolve(element);
            });
    });
}
                    </code></pre>
                </section>
                <section>
                    <h2>So then we can do</h2>
                    <pre><code>
var upRight =// function def
var goDown = // function def
// equivalent!

goDown(element)
.then(function(element){
    return upRight(element);
});

goDown(element)
.then(upRight);
                        </code></pre>
                </section>
                <section>
                    <h2>Update all our functions to use chaining and we can get to</h2>
                        <pre><code>
var leftFull = // function def
var wideSeeThrough = // function def
var upRight =// function def
var goDown = // function def

goDown(element)
.then(upRight)
.then(wideSeeThrough)
.then(leftFull);
                        </code></pre>
                </section>
                <section>
                    <h2>Pretty cool... </h2>
                    <h2 class="fragment">is that it?</h2>

                </section>
                <section>
                    <h2>Actually no</h2>
                    <p>Promises really start to shine when you use them as a control library</p>

                </section>
                <section>
                    <h2>New Example</h2>
                    <p>Shamelessly taken from <a href="http://www.html5rocks.com/en/tutorials/es6/promises/">HTML5Rocks</a> example</p>
                    <ul>
                        <li>Start up a spinner</li>
                        <li>Fetch some JSON from our server</li>
                        <li>Fetch child JSON</li>
                        <li>Render child data to page</li>
                        <li>Stop the spinner</li>
                    </ul>

                </section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

        <script src="js/animate.js"></script>

	</body>
</html>
